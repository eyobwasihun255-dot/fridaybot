# Render Deployment Guide

## Quick Setup for Render.com

### 1. Service Configuration

**Service Type:** Web Service  
**Language:** Node  
**Environment:** Node  
**Region:** Choose closest to your users  
**Branch:** `main` (or your default branch)  
**Root Directory:** (leave empty - root of repo)

### 2. Build & Start Commands

**Build Command:**
```bash
npm install && npm run build
```

**Start Command:**
```bash
npm start
```

**Health Check Path:**
```
/health
```

### 3. Environment Variables

Set these in Render Dashboard → Environment:

#### Required Variables:

```env
# Server Configuration
NODE_ENV=production
PORT=10000

# URLs (Update with your Render URL after first deploy)
WEBAPP_URL=https://your-service-name.onrender.com
CLIENT_URL=https://your-service-name.onrender.com

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=123456789,987654321  # Comma-separated admin Telegram IDs

# Firebase Configuration
FIREBASE_API_KEY=your_firebase_api_key
FIREBASE_AUTH_DOMAIN=your_firebase_auth_domain
FIREBASE_DATABASE_URL=your_firebase_database_url
FIREBASE_PROJECT_ID=your_firebase_project_id
FIREBASE_STORAGE_BUCKET=your_firebase_storage_bucket
FIREBASE_MESSAGING_SENDER_ID=your_firebase_messaging_sender_id
FIREBASE_APP_ID=your_firebase_app_id

# Redis Configuration (Cloud Redis - Upstash, Redis Cloud, etc.)
REDIS_URL=rediss://user:password@host:port
# OR use separate config:
# REDIS_HOST=your-redis-host
# REDIS_PORT=6379
# REDIS_PASSWORD=your-redis-password
```

### 4. Deployment Steps

1. **Connect Repository**
   - Connect your GitHub/GitLab repository to Render
   - Select the repository

2. **Create Web Service**
   - Click "New" → "Web Service"
   - Select your repository

3. **Configure Service**
   - **Name:** `friday-bingo-server` (or your preferred name)
   - **Environment:** `Node`
   - **Region:** Choose closest region
   - **Branch:** `main`
   - **Root Directory:** (leave empty)

4. **Build & Start Commands**
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm start`
   - **Health Check Path:** `/health`

5. **Add Environment Variables**
   - Add all variables listed above
   - **Important:** Update `WEBAPP_URL` and `CLIENT_URL` after first deployment with your actual Render URL

6. **Deploy**
   - Click "Create Web Service"
   - Render will build and deploy

### 5. Post-Deployment

After first deployment:

1. **Update URLs**
   - Copy your Render service URL (e.g., `https://fridaybot-9jrb.onrender.com`)
   - Update `WEBAPP_URL` and `CLIENT_URL` environment variables in Render dashboard
   - Redeploy (or Render will auto-redeploy)

2. **Set Telegram Webhook** (Optional - if not using polling)
   ```bash
   curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://your-service-name.onrender.com/api/bot"
   ```

3. **Verify Health Check**
   ```bash
   curl https://your-service-name.onrender.com/health
   ```
   Should return: `{"status":"Server running","timestamp":"..."}`

### 6. Local Development

**Run both frontend and backend together:**
```bash
npm run dev:all
```

**Or separately:**
```bash
# Terminal 1: Frontend (Vite)
npm run dev

# Terminal 2: Backend (Express + Socket.IO)
npm run dev:server
```

### 7. Project Structure

```
fridaybot/
├── api/              # Backend API (Express + Socket.IO)
│   ├── server.js     # Main server entry point
│   ├── bot.js        # Telegram bot handler
│   ├── game-manager.js  # Game logic
│   └── ...
├── src/              # Frontend (React + Vite)
│   ├── components/
│   ├── pages/
│   ├── store/
│   └── ...
├── dist/             # Built frontend (generated by `npm run build`)
├── package.json
└── render.yaml       # Render configuration (optional)
```

### 8. How It Works

1. **Build Process:**
   - `npm install` - Installs all dependencies
   - `npm run build` - Builds React frontend to `dist/` folder

2. **Start Process:**
   - `npm start` - Runs `npm run build && node api/server.js`
   - Express server serves:
     - Static files from `dist/` (frontend)
     - API routes under `/api/*`
     - Socket.IO for real-time updates

3. **Single Service:**
   - Frontend and backend run in the same Node.js process
   - No need for separate services
   - All served from one URL

### 9. Troubleshooting

**Build Fails:**
- Check Node version (should be 18+)
- Verify all dependencies in `package.json`
- Check build logs in Render dashboard

**Start Fails:**
- Verify `PORT` environment variable is set
- Check that `dist/` folder exists after build
- Verify all required environment variables are set

**Socket.IO Not Connecting:**
- Check `CLIENT_URL` matches your frontend URL
- Verify CORS settings in `socket-server.js`
- Check browser console for connection errors

**Telegram Bot Not Responding:**
- Verify `TELEGRAM_BOT_TOKEN` is correct
- Check if using webhook or polling mode
- Check Render logs for bot errors

### 10. Environment-Specific Notes

**Development:**
- Uses `http://localhost:5000` for backend
- Uses `http://localhost:5173` for frontend (Vite dev server)
- Polling mode available with `BOT_POLLING=true`

**Production (Render):**
- Single service serves both frontend and backend
- Uses environment variables for all URLs
- Webhook mode recommended for Telegram bot

### 11. Cost Optimization

- **Free Tier:** 750 hours/month
- **Starter Plan:** $7/month (always on)
- Single service reduces costs vs. separate frontend/backend

### 12. Scaling

If you need to scale:
- Upgrade to higher Render plan
- Consider separating frontend (static hosting) and backend (API service)
- Use Redis for session/state management (already configured)

